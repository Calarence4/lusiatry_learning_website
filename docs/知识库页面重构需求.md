# 知识库页面重构需求

## 概述

为知识库页面新增阅读模式和编辑模式，实现类似 Obsidian 的 Markdown 编辑体验。

## 功能需求

### 1. 阅读模式（默认模式）

#### 触发条件
- 当用户选中笔记或草稿时，自动切换为阅读模式

#### 功能特性
- **纯渲染显示**：不展示 Markdown 源代码
- **无工具条**：隐藏所有编辑工具
- **底部按钮**：提供"编辑模式"按钮切换到编辑状态

### 2. 编辑模式

#### 默认子模式：阅览模式（Live Preview）
- **自动渲染**：输入的 Markdown 代码实时渲染为预览
- **智能显示**：当光标位于特定语法结构时，该结构显示为源代码
  - Markdown 语法结构（如 `**粗体**`、`# 标题` 等）
  - LaTeX 数学公式语法（如 `$公式$`、`\(\)` 等）
  - 代码块（```` ``` ````）

#### 源代码模式
- **纯文本编辑**：只显示 Markdown 源代码
- **无预览渲染**：不进行 Markdown 渲染

### 3. 编辑工具条

#### 位置
- 仅在编辑模式下显示

#### 功能按钮
- **Markdown 语法快捷键**：
  - 标题（H1-H6）
  - 文本格式（加粗、斜体、删除线）
  - 列表（无序、有序、任务列表）
  - 引用、行内代码、代码块
  - 链接、图片、表格
  - 分割线
  - 其他常用 Markdown 语法

#### 模式切换
- **预览模式按钮**：切换到阅览模式（Live Preview）
- **源代码模式按钮**：切换到纯源代码编辑模式

## 技术实现要点

### 核心技术栈
- **编辑器引擎**：CodeMirror 6（支持 Live Preview）
- **Markdown 解析**：remark + rehype
- **数学公式**：KaTeX
- **UI 框架**：React + Tailwind CSS

### 关键实现
1. **状态管理**：viewMode（read/edit）+ editMode（live/source）
2. **Live Preview**：光标位置检测 + 语法结构识别 + 条件渲染
3. **工具条集成**：快捷键绑定 + 文本插入/包裹操作
4. **模式切换**：平滑过渡 + 状态同步

### 用户体验
- **自动切换**：选中文件时自动进入阅读模式
- **无缝编辑**：阅览模式下实时预览，源代码模式下专注编辑
- **智能提示**：光标所在语法结构高亮显示源代码
- **快捷操作**：工具条提供一键插入常用语法

## 验收标准

1. ✅ 选中笔记自动进入阅读模式
2. ✅ 阅读模式下无源代码、无工具条、有编辑按钮
3. ✅ 编辑模式默认阅览模式，支持实时预览
4. ✅ 光标所在语法结构显示源代码
5. ✅ 工具条包含完整 Markdown 快捷操作
6. ✅ 可在阅览模式和源代码模式间切换
7. ✅ 源代码模式只显示纯文本，不渲染预览</content>
<parameter name="filePath">g:\Projects\lusiatry_learning_website\docs\知识库页面重构需求.md